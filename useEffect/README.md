# useEffect

<h2>Что такое useEffect</h2>

- [x] `useEffect()` - это хук, который позволяет синхронизировать наш компонент с внешней системой (сущность, не относящаяся к React), когда это необходимо. К внешней системе относится:

<br>

  + **`Получение данных из API`** : Отправка запроса на сервер и получение данных для помещения их в стейт.
  + **`Подписка на события`** : Сиуации, когда компонент должен подписаться на внешние события - события браузера/окна/клавиатуры например, события WebSockets - когда компонент должен подписаться на события сокетов (типа открыли чат и установили прямое соеденение).
  + **`Обновление заголовка документа`** : Браузер так же внешняя система, и для взаимодействовать с ним можно так же с хуком, например, чтобы установить заголовок вкладки.
  + **`Отправка аналитических данных и сбор метрик`** : при открытии / закрытии компонента можно собирать данные о взаимодействии пользователя с приложением.

<br>

  - [ ] любые действия, которые необходимо выполнить помимо обычного рендеринга компонентов, такие как получение данных из API, подписка на события, обновление документа и т.д называются `Side effects`

<hr>
<br>
<br>

<h2>Возможно, вам не понадобится эффект</h2>

![image](https://github.com/acidshotgun/react-hooks-new/assets/117285472/e122a93f-0647-4acc-8f1f-2ac623a27b3e)

<hr>
<br>
<br>

<h2>Как написать эффект</h2>

  - [ ]  `Объявить эффект`. По умолчанию ваш эффект будет запускаться после каждого рендеринга.
  - [ ] `Указать зависимости эффекта`. Большинство эффектов следует запускать повторно только при необходимости , а не после каждого рендеринга. Например, анимация постепенного появления должна срабатывать только при появлении компонента. Подключение и отключение от комнаты чата должно происходить только при появлении и исчезновении компонента или при изменении комнаты чата.
  - [ ] `При необходимости добавьте очистку`. Некоторым эффектам необходимо указать, как остановить, отменить или очистить все, что они делали. Например, для «подключения» необходимо «отключить», для «подписки» необходимо «отменить подписку», а для «извлечения» необходимо либо «отменить», либо «игнорировать»

```javascript
    useEffect(() => {
      // Логика хука

      return () => {
        // Отписка 
      };
      // Массив зависимостей
    }, [...]);
```

<hr>
<br>
<br>

<h2>Как работает хук useEffect ?</h2>

- [ ] `Вызов при каждом рендеринге`:

	+ При каждом рендеринге компонента React вызывает все эффекты, определенные внутри хука `useEffect`.

<br>

- [ ] `Определение зависимостей:`:

  + `useEffect` принимает два аргумента: `функцию-эффект` и `массив зависимостей`.
    
  + Если массив зависимостей передается, React будет сравнивать значения зависимостей между предыдущим и текущим рендером.
    
  + Если хотя бы одна из зависимостей изменилась, React запустит эффект заново.
    
  + Если массив зависимостей пуст или не указан, эффект будет запускаться при каждом рендеринге.
     
<br>

- [ ] `Очистка эффекта`:

  + Функция-эффект может возвращать `функцию очистки`, которая будет вызвана перед тем, как компонент будет удален из DOM.
	
  + Это позволяет проводить очистку, отписываться от событий или убирать таймеры, чтобы избежать утечек ресурсов.

<br>

- [ ] `Основные моменты`:

  + Эффекты выполняются ПОСЛЕ того, как браузер отрисовал изменения на странице. (блок ретёрн)
	
  + Они гарантируют, что код эффекта не блокирует отображение пользовательского интерфейса.
     
  + При каждом рендеринге компонента React вызывает эффекты в том порядке, в котором они определены в коде.
     
<hr>
<br>
<br>

<h2>ПРИМЕРЫ:</h2>

[ПРИМЕР С API ЗАПРОСОМ](https://codesandbox.io/p/sandbox/useeffect-api-connect-9flfj7?file=%2Fsrc%2FApp.js)

[ПРИМЕР С ПОДПИСКОЙ НА СОБЫТИЯ БРАУЗЕРА (И ОТПИСКОЙ)](https://codesandbox.io/p/sandbox/useeffect-event-listener-wvgyxl?file=%2Fsrc%2FModal.js)

[ПРИМЕР С ВИДЕО](https://codesandbox.io/p/sandbox/useeffect-video-player-lfrqg7?file=%2Fsrc%2FVideoPlayer.js)

<hr>
<br>
<br>

<h2>ДОПОЛНИТЕЛЬНАЯ ЧАСТЬ useInsertionEffect и useLayoutEffect:</h2>

  - [ ] `useLayoutEffect`

  + `useEffect` выполняется после того, как браузер обновит DOM и отрисует изменения, что делает его асинхронным.

  + `useLayoutEffect` выполняется синхронно после того, как React обновит DOM, но перед тем, как браузер отрисует изменения, что делает его синхронным.

  + `useLayoutEffect` следует использовать тогда, когда ваши эффекты должны быть синхронизированы с отображением DOM, или когда вы работаете с измерениями или расположением элементов, чтобы избежать мерцания или несоответствий в интерфейсе.

  + `useEffect` более производительный


  - [ ]  `useInsertionEffect` - предназначен для авторов библиотек CSS-in-JS
